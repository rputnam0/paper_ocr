Metadata-Version: 2.4
Name: paper-ocr
Version: 0.1.0
Summary: Born-digital-aware PDF to Markdown pipeline using olmOCR via DeepInfra
Author: paper_ocr
License: MIT
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: pymupdf>=1.24.0
Requires-Dist: Pillow>=10.0.0
Requires-Dist: pyyaml>=6.0.1
Requires-Dist: python-dotenv>=1.0.1
Requires-Dist: openai>=1.40.0
Requires-Dist: telethon>=1.36.0
Requires-Dist: tqdm>=4.66.0
Requires-Dist: pytest>=8.0.0

# paper-ocr

Born-digital-aware PDF to Markdown pipeline using olmOCR via DeepInfra.

## Quick start

```bash
uv run paper-ocr run data/LISA out
```

Set `DEEPINFRA_API_KEY` in `.env` or your environment.

## Telegram DOI fetch workflow

1. Fetch PDFs from your Telegram bot using a DOI CSV:
```bash
uv run paper-ocr fetch-telegram input/papers.csv
```
2. Run OCR on the fetched PDFs:
```bash
uv run paper-ocr run data/telegram_jobs/papers/pdfs data/telegram_jobs/papers/ocr_out
```

Folder layout for a CSV named `papers.csv` (job folder uses CSV stem):
```
data/telegram_jobs/papers/
  input/
    papers.csv
  pdfs/
    <bot_paper_title>.pdf
  reports/
    telegram_download_report.csv
    telegram_failed_papers.csv
    download_index.json
  ocr_out/
```

Notes:
- `pdfs/` is the intermediate OCR input.
- `ocr_out/` is reserved for final OCR outputs.
- PDF filenames are derived from bot-provided paper titles (DOI fallback if title is missing).

Required env vars for fetch:
- `TG_API_ID`
- `TG_API_HASH`

Optional env vars for fetch defaults:
- `TARGET_BOT` (required unless passed via `--target-bot`)
- `MIN_DELAY` (default `4`)
- `MAX_DELAY` (default `8`)

CLI timeout default for bot response:
- `--response-timeout` (default `15` seconds per poll)
- `--search-timeout` (default `40` seconds total after bot says it is searching)

Key options:
- `--text-only` enables text-layer extraction when high-quality text is detected (skips VLM).
- `--metadata-model` sets the post-OCR bibliographic extraction model used for naming outputs.
  - Also used for discovery metadata extraction from the first few pages (abstract + topics).

## Output layout
For each PDF:
```
out/<input_parent_folder>/
  README.md
out/<input_parent_folder>/<author_year>/
  <paper_title>.md
  pages/
    0001.md
    0002.md
  metadata/
    manifest.json
    bibliography.json
    discovery.json
    sections.json
    document.jsonl
    assets/
    debug/
```

Notes:
- `author_year` is metadata-derived (snake case, e.g. `Carreau_Pierre_J_1972`) using the first page.
- The consolidated markdown filename is derived from extracted paper title.
- Each parent output folder also gets a generated `README.md` paper index for quick LLM discovery.
- Discovery summary is abstract-first: extracted from the opening pages instead of whole-document summarization.
